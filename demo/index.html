<!DOCTYPE html>
<html lang="en" ng-app="sliderDemoApp" id="top">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>AngularUI - Slider demo</title>
	<base href=".."></base>
  	<link rel="stylesheet" href="jquery-ui/themes/smoothness/jquery-ui.css">
	
</head>
<body ng-controller="sliderDemoCtrl">

	
	
	
    <div ui-slider="slider.options" min="0" max="{{log._undoHistory.length + log._redoHistory.length }}" step ="1" ng-model="sliderPosition"></div>
    <br/>
    <br/>
    <div><input type="text" ng-model="testNum.value" /></div>
	
	
	<script type="text/javascript" src="jquery/dist/jquery.min.js"></script>
  	<script type="text/javascript" src="jquery-ui/ui/minified/jquery-ui.min.js"></script>
  	<script type="text/javascript" src="angular/angular.min.js"></script>	
	<script type="text/javascript" src="slider.js"></script>
    <script type="text/javascript" src="weavecore.js"></script>
	<script>
		var app = angular.module('sliderDemoApp', ['ui.slider']);
		  
        var sc;
		
		app.controller('sliderDemoCtrl', function($scope, $log) {
            sc = $scope;
            
            $scope.safeApply = function(fn) {
                  var phase = this.$root.$$phase;
                  if(phase == '$apply' || phase == '$digest') {
                    if(fn && (typeof(fn) === 'function')) {
                      fn();
                    }
                  } else {
                    this.$apply(fn);
                  }
                };
		
			 // Slider options with event handlers
			$scope.slider = {
				'options': {
					start: function (event, ui) { 
                        $log.info('Event: Slider start');
                    },
    				stop: function (event, ui) { 
                        $log.info('Event: Slider stop'); 
                        handleSliderValueChange(ui);
                    }
				}
			}
            
            $scope.sliderPosition;
            
            WeaveAPI.root = new weavecore.LinkableHashMap();
            $scope.log = new weavecore.SessionStateLog(WeaveAPI.root);
            var cc = WeaveAPI.SessionManager.getCallbackCollection($scope.log);
            cc.addGroupedCallback({},updateSliderValues);
            
            $scope.testNum = WeaveAPI.root.requestObject('testNum',weavecore.LinkableNumber,false);
            $scope.testNum.value = 1;
            
            $scope.log.clearHistory();
            
            function updateSliderValues(){
                $scope.sliderPosition = $scope.log._undoHistory.length ;
                console.log("Slider Position After Log Change", $scope.sliderPosition);
            }
            
            function handleSliderValueChange(ui){
                var delta = ui.value - $scope.log.undoHistory.length;
				if (delta < 0)
					$scope.log.undo(-delta);
				else
					$scope.log.redo(delta);
                
                $scope.$apply();
                
                console.log("Handle Slider value Change", ui.value);
                console.log("Slider Position", $scope.sliderPosition);
            }
			
		});
	</script>
</body>
</html>
